# File structure

This document describes the emwy repository layout and where different types of files belong.

## Top-level layout

```
emwy/
  AGENTS.md              Agent collaboration guidance
  Brewfile               Homebrew dependencies for macOS
  EMWY_YAML_v1_SPEC.md   Legacy v1 format specification (deprecated)
  EMWY_YAML_v2_SPEC.md   Current v2 format specification
  LICENSE                GPLv3 license text
  MANIFEST.in            Package manifest for sdist builds
  README.md              Project overview and quickstart
  emwy_cli.py            Primary CLI entry point
  emwy_tui.py            Textual TUI wrapper for renders
  pip_requirements.txt   Python dependencies
  pyproject.toml         Package metadata and build config
  devel/                 Developer and release scripts
  docs/                  Documentation
  emwylib/               Core Python library
  samples/               Example project files
  tests/                 Test suite
  tools/                 Helper scripts and utilities
```

## Key subtrees

### emwylib/

Core library code:

```
emwylib/
  __init__.py
  version.py           Package version string
  titlecard.py         Title card image generation
  transforms.py        RGB color transforms
  ffmpeglib.py         FFmpeg helpers
  soxlib.py            Sox helpers
  medialib.py          Media inspection utilities
  core/                Core pipeline modules
    __init__.py
    loader.py          YAML v2 parser
    timeline.py        Timeline compiler
    renderer.py        Render executor
    project.py         EmwyProject orchestrator
    utils.py           Shared utilities
  media/               Low-level media wrappers
    __init__.py
    ffmpeg.py          FFmpeg interface
    ffmpeg_extract.py  FFmpeg extraction commands
    ffmpeg_render.py   FFmpeg rendering commands
    sox.py             Sox interface
    sox_normalize.py   Sox normalization
    sox_edit.py        Sox editing
  exporters/           Export format modules
    __init__.py
    mlt.py             MLT XML exporter
```

### tests/

Test suite and static analysis:

```
tests/
  run_pyflakes.sh              Pyflakes static analysis runner
  font_utils.py                Font discovery test helper
  render_titlecard.py          Titlecard render helper
  test_emwy_yaml_writer.py     YAML writer tests
  test_enabled_entries.py      Entry enable/disable tests
  test_ffmpeg_overlays.py      Overlay rendering tests
  test_font_usage.py           Font path tests
  test_integration_render.py   End-to-end render tests
  test_mlt_export.py           MLT export tests
  test_playback_styles.py      Playback style tests
  test_render_tooling.py       Tooling behavior tests
  test_speed_sync.py           Speed synchronization tests
  test_tui_metrics.py          TUI metrics tests
```

### tools/

Helper scripts for common workflows:

```
tools/
  README.md                    Tools documentation
  silence_annotator.py         Silence detection and EMWY YAML generation
  emwy_yaml_writer.py          YAML output helper module
  video_scruncher.py           Video compression utility
  config_silence.yml           Silence annotator config example
  demo_codex.mp4.emwy.yaml     Demo project file
  demo_codex.small.emwy.yaml   Minimal demo project
```

### devel/

Developer and release automation:

```
devel/
  commit_changelog.py          Changelog commit helper
  submit_to_pypi.py            PyPI release script
```

### samples/

Example project files for testing and demonstration:

```
samples/
  gangnam.emwy.yaml            Example music video project
  runGangnam_v2.sh             Run script for gangnam example
  secret_of_51.emwy.yaml       Another example project
```

## Generated artifacts

The following are generated and ignored by git:

- `__pycache__/`: Python bytecode
- `*.pyc`, `*.pyo`: Compiled Python files
- `build/`, `dist/`, `*.egg-info/`: Package build outputs
- `.pytest_cache/`: Pytest cache
- `.mypy_cache/`: Mypy cache
- `pyflakes.txt`: Pyflakes output (generated by `run_pyflakes.sh`)
- `*.mkv`, `*.mp4`, `*.avi`: Video outputs (in some configurations)

Temporary render files go to a per-run temp directory by default (controlled by `--cache-dir`).

## Documentation map

Documentation lives in `docs/`:

- `CHANGELOG.md`: User-facing change history
- `CLI.md`: Command-line options
- `CODE_ARCHITECTURE.md`: Code structure (this companion)
- `COOKBOOK.md`: Editing recipes
- `DEBUGGING.md`: Troubleshooting
- `DEVELOPMENT.md`: Developer setup
- `FAQ.md`: Common questions
- `FORMAT.md`: YAML project file format
- `INSTALL.md`: Installation instructions
- `MLT_INTEROP.md`: MLT XML mapping
- `EXPORT_MLT_XML_SPEC.md`: MLT export behavior
- `IMPORT_MLT_XML_SPEC.md`: MLT import draft spec
- `PYTHON_STYLE.md`: Python coding conventions
- `REPO_STYLE.md`: Repository conventions
- `MARKDOWN_STYLE.md`: Markdown formatting rules
- `RELEASE_HISTORY.md`: Version release log
- `ROADMAP.md`: Planned work
- `SHOTCUT.md`: Shotcut compatibility
- `TODO.md`: Backlog tasks
- `TOOLS.md`: Helper script documentation

Root-level docs:

- `README.md`: Project overview
- `AGENTS.md`: Agent collaboration guidance
- `LICENSE`: License text
- `EMWY_YAML_v2_SPEC.md`: Format specification (kept at root for visibility)

## Where to add new work

### New Python code

- Core pipeline changes: `emwylib/core/`
- Media processing: `emwylib/media/`
- New export formats: `emwylib/exporters/`
- New import formats: `emwylib/importers/` (create if needed)
- Image generation: `emwylib/titlecard.py` or new module in `emwylib/`

### New tests

- Add to `tests/` with filename `test_*.py`
- Use pytest fixtures and assertions
- Keep tests deterministic and fast

### New documentation

- User-facing docs: `docs/` with SCREAMING_SNAKE_CASE filename
- Update `docs/CHANGELOG.md` for any user-facing changes

### New tools

- Add to `tools/` with descriptive snake_case filename
- Document in `docs/TOOLS.md`

### New sample projects

- Add to `samples/` with `.emwy.yaml` extension
- Include run script if helpful
