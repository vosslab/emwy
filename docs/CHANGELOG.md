# Changelog

## Unreleased
- Simplified README with a short quick start and curated documentation links.
- Refreshed CODE_ARCHITECTURE and FILE_STRUCTURE docs to match current layout and entry points.
- Updated INSTALL and added USAGE docs with verified commands and known gaps.
- Fixed README quick start command to include the required YAML flag.
- Raised on failed external commands and normalized whitespace in runCmd output.
- Defaulted output video_codec to libx264 to match the v2 spec and ffmpeg availability.
- Added x264 vs x265 guidance for YouTube uploads in the v2 spec output section.
- Removed shebangs from non-executable modules and test helpers; kept tool shebangs.
- Added a python3 shebang and executable bit for tools/video_scruncher.py.
- Defaulted titlecard movie encoding to libx264 for wider ffmpeg compatibility.
- Added `tools/stabilize_building.py` standalone "bird on a building" stabilization tool (vid.stab via ffmpeg) with crop-to-content and a sidecar report.
- Added optional, budgeted border fill fallback for rare jerk frames when crop-only is infeasible.
- Improved stabilize_building motion rejection reporting with per-metric thresholds, reason codes, and a one-screen stderr summary.
- Fixed stabilize_building to treat vid.stab transforms as relative when deriving global motions and applying stabilization.
- Switched stabilize_building motion rejection from strict max thresholds to a budgeted outlier model (rare bad frames allowed; rejects sustained motion/zoom/rotation).
- Added `motion.required_thresholds_to_pass` to stabilize_building reports on motion rejection failures.
- Updated stabilize_building default motion thresholds to be permissive enough to pass phone clips with occasional extreme frames (tune down after confirming pipeline).
- Added a stderr note when stabilize_building uses an existing default config file so runs do not accidentally ignore new code defaults.
- Updated stabilize_building default border fill budgets to tolerate short jerk bursts while keeping the fill fraction constrained.
- Adjusted fill fallback crop selection to meet basic constraints without forcing safe-region containment, and emit a warning (not a hard fail) when fill can reach into the safe region.
- Fixed stabilize_building audio copying to select a single usable audio stream (avoid codec-none auxiliary tracks that can break muxing).
- Changed stabilize_building config behavior: when `-c` is omitted, no config file is read or written (code defaults only); added explicit `--write-default-config` and `--use-default-config` modes.
- Documented the stabilization tool in `docs/TOOLS.md`, `docs/FILE_STRUCTURE.md`, and `tools/README.md` and aligned the stabilization plan with the implementation approach.
- Added pytest coverage for `tools/stabilize_building.py` including crop-only and fill-fallback modes using tiny synthetic clips.
- Added concrete algorithm guidance for the stabilization tool (motion parsing, frame alignment, smoothing, crop computation) and a transform-only test suite idea.
- Specified a concrete crop-rectangle derivation (intersection of per-frame valid regions) and added minimal motion-path reliability heuristics.
- Clarified crop feasibility derivation from the motion path and defined minimum failure/unreliable-analysis rules for the stabilization tool.
- Clarified the stabilization tool contract to require exactly two decode passes per analysis and to base crop feasibility on analysis metadata.
- Tightened stabilization tool plan wording to remove remaining YAML-feature drift and standardize "crop infeasible" failure language.
- Clarified the stabilization tool outputs (stabilized video + sidecar report) and failure behavior as media preparation rather than YAML editing intent.
- Decided stabilization will ship as a standalone tool (like `tools/silence_annotator.py`) instead of adding new EMWY YAML v2 authoring fields.
- Resolved remaining stabilization-plan contradictions (determinism wording, crop-only enforcement, and precise crop constraint definitions).
- Tightened stabilization plan guarantees: removed bitwise reproducibility, committed to crop-only borders, and added explicit failure thresholds and motion/zoom/subtitle rules.
- Clarified the "bird on a building" mental model: globally align to keep the building static and fail when the building leaves the usable crop.
- Tightened the stabilization plan to default to crop-to-content with explicit failure on low overlap to keep the frame center in view.
- Expanded the stabilization feature plan with vid.stab-specific notes on determinism, caching, border fill, and failure modes.
- Added `docs/STABILIZATION_TOOL_PLAN.md` (renamed from `docs/STABILIZATION_FEATURE_PLAN.md`) documenting global video stabilization guarantees and an implementation plan.
- Updated CODE_ARCHITECTURE.md with detailed component descriptions and data flow.
- Added FILE_STRUCTURE.md documenting repository layout and file organization.
- Frozen TUI elapsed time once completion is printed.
- Fixed command total estimation for animated overlay text generators.
- Colorized dashboard and project panels to match the Nord-style palette.
- Shifted TUI command highlighting to a Nord-style, low-saturation palette.
- Added overlay_text animation cycle support with `{animate}` placeholders and YAML output.
- Updated silence_annotator defaults to emit animated fast-forward overlays.
- Updated `tools/config_silence.yml` and `docs/TOOLS.md` sample config to enable animated overlays.
- Documented overlay text animation fields and added YAML writer test coverage.
- Updated demo_codex overlay templates to use animated fast-forward text.
- Added CLI-style command highlighting for emwy_tui command logs.
- Fixed overlay compositing opacity filter for recent ffmpeg colorchannelmixer parsing.
- Reset emwy_tui debug log on each run instead of appending.
- Added pytest coverage for overlay ffmpeg behaviors.
- Removed deprecated Pillow mode arguments in titlecard image creation.
- Added pytest coverage for ffmpeg/sox/mkvmerge tooling behaviors.
- Relaxed tooling test duration bounds and added minimal assets to generator tests.
- Added pytest coverage for custom font_file rendering.
- Added ETA and improved elapsed time formatting in emwy_tui metrics.
- Fixed command total estimate to include chapter muxing and surfaced command total calculation in the TUI.
- Added a COMPLETE! ASCII banner in the TUI finish state.
- Added TUI command coloring and clearer ETA updates while sampling command durations.
- Moved ETA display onto the Commands line in the TUI dashboard.
- Added unit tests for TUI ETA and duration formatting.
- Updated demo_codex overlay text style to use a boxed background and adjusted overlay opacity.
- Softened TUI command log colors for a subtler look.
- Added estimated total time to the elapsed display in the TUI dashboard.
- Removed decimals from estimated ETA/total times in the TUI dashboard.
- Rounded estimated ETA/total times up to the next whole second.
- Delay ETA display until at least 8 commands have completed.
- Update ETA estimates only after command completion and adjust remaining-time formula.
- Adjusted ETA formula to weight the last steps (remaining + 3).
- Render overlay generator cards at overlay geometry size and error on missing font files.
- Added a unit test to confirm custom font paths are used during card rendering.
- Added system font discovery helper for cross-platform font tests.
- Improved vertical centering of overlay text and card text using font bounding boxes.
- Updated AGENTS guidance with notes for future Codex runs.
- Merge batching now occurs during segment/overlay generation instead of only at the end.
- Disabled tqdm in quiet mode to avoid multiprocessing lock errors in the TUI.
- Added a debug log mode for emwy_tui.py and colorized command output when rich is available.
- Added a subprocess fallback for fds_to_keep errors during command execution.
- Added `emwy_cli.py` and moved `emwy_tui.py` to the repo root.
- Added output merge batching controls for large timelines.
- Fixed overlay transparent blanks to preserve alpha so overlays do not show black boxes.
- Added a Textual TUI wrapper for emwy renders.
- Replaced deprecated scipy.ndimage.filters import in title card rendering.
- Defaulted cache directory for temporary render files to a per-run temp dir.
- Fixed title card ffmpeg profile for libx265 to avoid zero-byte output files.
- Fixed title card image rendering to use the temp directory pattern for ffmpeg input.
- Added silence annotator trim_leading_silence/trim_trailing_silence options (default true).
- Fixed title card rendering with newer Pillow versions (getbbox fallback).
- Standardized silence annotator outputs to use `<input>.*` filenames (including extensions).
- Allowed playback styles to supply overlay_text_style defaults for overlay templates.
- Added docs/TODO.md with MLT overlay export pre-render task.
- Renamed silence annotator fast playback style id to `fast_forward`.
- Added playback_styles to apply shared speed presets to source segments.
- Added default silence annotator intro title card output.
- Enforced matching audio/video speeds on source segments.
- Added overlay_text generator and overlay_text_styles for dedicated overlay labels.
- Added overlay template apply rules so fast-forward title cards can be authored once.
- Added overlay tracks with transparent blanks and overlay rendering support.
- Added `still` generator support and transparent card backgrounds for overlays.
- Documented overlay authoring and updated Shotcut export limitations.
- Updated silence annotator YAML to include fast-forward overlays.
- Fixed pyflakes runner to avoid null-separated sort errors.
- Documented MLT interop mapping and added export test coverage.
- Added silence annotator config file support and simplified CLI flags.
- Polished silence annotator config validation and defaults handling.
- Added MLT import/export specification docs.
- Added `pyproject.toml` and `MANIFEST.in` for packaging metadata.
- Added centralized version file and release history doc.
- Expanded pyflakes runner output with categorized error counts.
- Expanded pyflakes error categorization patterns.
- Expanded pyflakes syntax error matching.
- Added output for unclassified pyflakes errors.
- Filtered pyflakes summaries to true error lines and added warning category.
- Filtered first/random/last pyflakes output to error lines only.
- Implemented MKV chapter export from segment titles.
- Reshaped README introduction to lead with the EMWY acronym and MLT compatibility.
- Clarified the EMWY acronym in the README.
- Resolved AGENTS documentation links to use `docs/` paths.
- Added `.DS_Store` to `.gitignore`.
- Fixed documentation links to `docs/PYTHON_STYLE.md`.
- Moved contributor guidance to `docs/DEVELOPMENT.md`.
- Renamed `docs/ARCHITECTURE.md` to `docs/CODE_ARCHITECTURE.md`.
- Added documentation scaffolding and agent descriptions.
- Introduced pip requirements file for development tooling.
- Documented installation, CLI usage, cookbook recipes, and troubleshooting tips.
- Added v2 sample project with `.emwy.yaml` extension and run script.
- Added MLT exporter module for v2 YAML projects.
- Split media wrappers into `emwylib/media` for ffmpeg and sox helpers.
- Added `paired_audio` expansion for generator entries when playlists are aligned.
- Made `timeline.segments` the required authoring surface; playlists/stack are compiled-only.
- Removed `take` support from v2 loader and timeline.
- Updated rendering to process and mux A/V per segment before concatenation.
- Added CLI flags for temp retention and cache directory (`--keep-temp`, `--cache-dir`).
- Added title/chapter card backgrounds (image, color, gradient) with font overrides.

## v1.0.0
- Initial public release of emwy with YAML v2 parser and CLI.
